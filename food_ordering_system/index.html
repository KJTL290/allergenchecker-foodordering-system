<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Food Ordering ‚Äî Choose Role</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif}
        body{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f4f6f8}
        .wrap{width:100%;max-width:980px;padding:30px}
        .header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
        .brand{font-size:1.6rem;font-weight:800;color:#333}
        .subtitle{color:#666;font-size:0.95rem}
        .roles{display:flex;gap:15px;margin:18px 0}
        .role{flex:1;background:white;border-radius:10px;padding:18px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.06);cursor:pointer;border:2px solid transparent}
        .role.active{border-color:#2196f3}
        .role h3{margin-bottom:8px}
        .role p{color:#666;font-size:0.95rem}
        .login-card{background:white;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06);max-width:420px;margin-top:10px}
        .form-group{margin-bottom:12px}
        label{display:block;font-weight:700;color:#333;margin-bottom:6px}
        input{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px}
        .login-btn{width:100%;padding:12px;border-radius:8px;background:#2196f3;color:white;border:none;font-weight:700;cursor:pointer}
        .login-btn:active{transform:translateY(1px)}
        .error{background:#ffebee;color:#c62828;padding:8px;border-radius:6px;margin-bottom:10px;display:none}
        .foot{margin-top:12px;color:#777;font-size:0.9rem}
        @media (max-width:720px){.roles{flex-direction:column}.role{width:100%}}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="header">
            <div class="brand">üçΩÔ∏è Food Ordering System</div>
            <div style="flex:1"></div>
            <div class="subtitle">Select your role to sign in</div>
        </div>

        <div class="roles">
            <div class="role active" data-app="admin" id="role-admin">
                <h3>Administrator</h3>
                <p>Manage menu, users and view history</p>
            </div>
            <div class="role" data-app="operations" id="role-ops">
                <h3>Kitchen / Operations</h3>
                <p>View and manage order queue</p>
            </div>
            <div class="role" data-app="kiosk" id="role-kiosk">
                <h3>Cashier / Kiosk</h3>
                <p>Open kiosk to take and pay orders</p>
            </div>
        </div>

        <div class="login-card">
            <div class="error" id="err">Invalid credentials or unauthorized for selected role</div>
            <div class="form-group">
                <label>Selected Role</label>
                <div id="selected-role" style="font-weight:700;color:#333">Administrator</div>
            </div>
            <div class="form-group">
                <label>Username</label>
                <input id="username" autocomplete="username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input id="password" type="password" autocomplete="current-password">
            </div>
            <button class="login-btn" id="btnLogin">Sign In</button>
            <div class="foot">Tip: Use existing accounts created under <code>Users</code>.</div>
        </div>
    </div>

    <script>
        // Role selection
        const roles = document.querySelectorAll('.role');
        let currentApp = 'admin';
        roles.forEach(r => r.addEventListener('click', () => {
            roles.forEach(x=>x.classList.remove('active'));
            r.classList.add('active');
            currentApp = r.dataset.app;
            document.getElementById('selected-role').innerText = r.querySelector('h3').innerText;
        }));

        // Preselect role when a query param is provided (e.g., ?view=kiosk)
        (function(){
            const params = new URLSearchParams(window.location.search);
            const q = params.get('view') || params.get('role');
            if(q) {
                const el = document.getElementById('role-' + q);
                if(el) el.click();
            }
        })();

        function showError(msg){ const e=document.getElementById('err'); e.innerText=msg||'Invalid credentials or unauthorized for selected role'; e.style.display='block'; setTimeout(()=>e.style.display='none',4000); }

        document.getElementById('btnLogin').addEventListener('click', login);
        document.getElementById('password').addEventListener('keypress', function(e){ if(e.key==='Enter') login(); });

        function login(){
            const user=document.getElementById('username').value.trim();
            const pass=document.getElementById('password').value;
            if(!user||!pass){ showError('Please fill username and password'); return; }
            fetch('auth.php?action=login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: user, password: pass, app: currentApp })
            }).then(r=>r.json()).then(data=>{
                if(data.status==='success'){
                    if(currentApp==='operations') window.location.href='operations.html';
                    else if(currentApp==='kiosk') {
                        // kiosk/cashier -> go to standalone kiosk page
                        window.location.href='kiosk.html';
                    } else window.location.href='dashboard.html';
                } else {
                    showError(data.message || 'Login failed');
                }
            }).catch(()=> showError('Cannot reach server'));
        }
    </script>
</body>
</html>